"use strict";(self.webpackChunkintelehealth_ui=self.webpackChunkintelehealth_ui||[]).push([[478],{6478:(B,h,a)=>{a.r(h),a.d(h,{HttpLoaderFactory:()=>A,VideoCallO3Module:()=>E});var g=a(7761),r=a(1149),f=a(9824),C=a(1279),m=a(1377),p=a(4476),u=a(9671),s=(a(685),a(2678)),x=a(4465),e=a(4650),O=a(7185),b=a(5383),M=a(6879),v=a(7154);function k(n,l){1&n&&(e.TgZ(0,"th",11),e._uU(1,"Name"),e.qZA())}function P(n,l){if(1&n&&(e.TgZ(0,"td",12),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.xp6(1),e.Oqu(t.name)}}function T(n,l){1&n&&(e.TgZ(0,"th",11),e._uU(1,"UUID"),e.qZA())}function y(n,l){if(1&n&&(e.TgZ(0,"td",13),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.xp6(1),e.Oqu(t.uuid)}}function _(n,l){1&n&&(e.TgZ(0,"th",11),e._uU(1,"Action"),e.qZA())}function U(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"td",13)(1,"button",14),e.NdJ("click",function(){const i=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.handleCallUser(i.uuid,i.name))}),e._uU(2,"Call"),e.qZA()()}}function S(n,l){1&n&&e._UZ(0,"tr",15)}function w(n,l){1&n&&e._UZ(0,"tr",16)}let I=(()=>{class n{constructor(t,o,c,i){this.toastr=t,this.socketService=o,this.coreService=c,this.pageTitleService=i,this.socket=null,this.displayedColumns=["name","uuid","action"],this.roomId=null,this.isCalling=!1,this.callTo=null,this.callAccepted=!1,this.token="",this.calledBy=null,this.isMuted=!1,this.isVideoOn=!1,this.room=null,this.callerName=null,this.dataSource=new r.by,this.currentUser=(0,x.TL)(!0,"user"),this.members=[{name:"Super User",uuid:"82f18b44-6814-11e8-923f-e9a88dcb533f"},{name:"Admin2",uuid:"0a09425b-9cea-4f04-a90d-200cda5edb1f"}],this.WS_URL="wss://demo.intelehealth.org:9090",this.SOCKET_SERVER_URL="wss://intelehealth-o3.mpower-social.com:3004",this.SERVER_URL_RTC="https://intelehealth-o3.mpower-social.com:3000"}handleAction(t){console.log("Action clicked for UUID:",t)}ngOnInit(){var t=this;return(0,u.Z)(function*(){t.dataSource.data=t.members,console.table(t.dataSource.data),console.log("ngOnInitngOnInit"),t.socket||(yield t.socketService.initSocket(!0)),console.log(t.socketService.socket,"this.socketService.socket"),t.socket=t.socketService.socket,t.pageTitleService.setTitle({title:"Video call to OpenMRS 3",imgUrl:"assets/svgs/video-frame.svg"})})()}ngOnDestroy(){this.socket&&(this.socket.disconnect(),this.socket=null)}handleJoinCall(t){this.socket&&this.roomId&&(this.socket.emit("create_or_join_hw",{patientId:this.roomId}),this.socket.emit("call-connected",{initiator:t,room:this.calledBy.room,socketId:this.calledBy.appSocketId,nurseId:this.calledBy.connectToDrId}),this.getToken(this.roomId,this.calledBy.nurseId),this.callAccepted=!0,this.isCalling=!1)}handleRejectCall(){this.socket&&(console.log("dr_call_reject",this.calledBy),this.socket.emit("dr_call_reject",this.calledBy.nurseId),this.isCalling=!1,this.roomId=null)}getToken(t,o){fetch(`${this.SERVER_URL_RTC}/api/getToken?name=b338f57d-69a9-4884-b077-c2059baf9ba4&roomId=${t}&nurseName=${o}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(i=>i.json()).then(i=>{this.token=i.token}).catch(i=>{console.error("Error fetching the token:",i)})}startCall(){if(this.dialogRef2)return this.dialogRef2.close(),void(this.isCalling=!1);this.isCalling=!0,this.dialogRef2=this.coreService.openVideoCallModal({patientId:this.generateUUID(),visitId:"",connectToDrId:this.currentUser.uuid,patientName:"Super User",nurseId:"82f18b44-6814-11e8-923f-e9a88dcb533f",initiator:"dr",drPersonUuid:"82f18b44-6814-11e8-923f-e9a88dcb533f"}),this.dialogRef2.afterClosed().subscribe(t=>{this.dialogRef2=void 0,this.isCalling=!1})}handleCallUser(t,o){if(console.log("handleCallUser",t,this.socket),this.socket){const c=this.generateUUID();this.getToken(c,t),this.roomId=c,this.callTo={name:o,nurseId:t},this.isCalling=!0,this.socket.emit("create_or_join_hw",{patientId:c,connectToDrId:t}),this.socket.emit("call",{nurseId:t,doctorName:this.currentUser.name,roomId:c})}this.startCall()}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=16*Math.random()|0;return("x"===t?o:3&o|8).toString(16)})}setupRoom(){var t=this;return(0,u.Z)(function*(){const o=new s.du({adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:s.z4.h1080},audioCaptureDefaults:{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}});o.prepareConnection(t.SERVER_URL_RTC,t.token),o.on(s.TQ.TrackSubscribed,t.handleTrackSubscribed).on(s.TQ.TrackUnsubscribed,t.handleTrackUnsubscribed).on(s.TQ.ActiveSpeakersChanged,t.handleActiveSpeakerChange).on(s.TQ.Disconnected,t.handleDisconnect).on(s.TQ.LocalTrackUnpublished,t.handleLocalTrackUnpublished),yield o.connect(t.WS_URL,t.token),console.log("Connected to room:",o.name),t.room=o,yield o.localParticipant.enableCameraAndMicrophone(),yield o.localParticipant.setMicrophoneEnabled(!1),yield o.localParticipant.setCameraEnabled(!1)})()}handleTrackSubscribed(t,o,c){if(t.kind===s.fQ.Kind.Video||t.kind===s.fQ.Kind.Audio){const i=t.attach(),d=document.getElementById("yourUserId");i instanceof HTMLVideoElement&&(i.style.width="100%",i.style.height="100%",i.style.objectFit="cover"),d&&d.appendChild(i)}}handleTrackUnsubscribed(t,o,c){t.detach().forEach(i=>i.remove())}handleLocalTrackUnpublished(t,o){t.track.detach().forEach(c=>c.remove())}handleActiveSpeakerChange(t){}handleDisconnect(){console.log("Disconnected from room")}toggleMute(){this.room&&(this.room.localParticipant.setMicrophoneEnabled(!this.isMuted),this.isMuted=!this.isMuted)}toggleVideo(){this.room&&(console.log("toggleVideo off"),this.room.localParticipant.setCameraEnabled(!this.isVideoOn),this.isVideoOn=!this.isVideoOn)}handleLeave(){console.log(this.calledBy,this.callTo),this.socket?.emit("cancel_dr",{socketId:this.socket.id,nurseId:this.calledBy?this.calledBy.nurseId:this.callTo?.nurseId}),this.resetCall()}resetCall(){this.room?.disconnect(),this.roomId=null,this.isCalling=!1,this.callAccepted=!1,this.callTo=null,this.calledBy=null,this.room=null,this.isMuted=!1,this.isVideoOn=!1}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(O._W),e.Y36(b.$),e.Y36(M.p),e.Y36(v.Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-video-call-list-data-table"]],decls:14,vars:3,consts:[[1,"container-fluid"],[1,"mat-elevation-z8"],["mat-table","",1,"mat-elevation-z8",2,"width","100%",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","font-weight: bold;",4,"matCellDef"],["matColumnDef","uuid"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",2,"font-weight","bold"],["mat-cell",""],["mat-raised-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"table",2),e.ynx(3,3),e.YNc(4,k,2,0,"th",4),e.YNc(5,P,2,1,"td",5),e.BQk(),e.ynx(6,6),e.YNc(7,T,2,0,"th",4),e.YNc(8,y,2,1,"td",7),e.BQk(),e.ynx(9,8),e.YNc(10,_,2,0,"th",4),e.YNc(11,U,3,0,"td",7),e.BQk(),e.YNc(12,S,1,0,"tr",9),e.YNc(13,w,1,0,"tr",10),e.qZA()()()),2&t&&(e.xp6(2),e.Q6J("dataSource",o.dataSource),e.xp6(10),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[r.BZ,r.fO,r.as,r.w1,r.Dz,r.nj,r.ge,r.ev,r.XQ,r.Gk,m.lW],styles:[".mat-elevation-z8[_ngcontent-%COMP%]{box-shadow:none;width:100%;overflow-x:auto}.container-fluid[_ngcontent-%COMP%]{box-shadow:0 4px 24px #1f1c3a14;padding:10px;border-radius:10px}.action-btn.bg-blue[_ngcontent-%COMP%]{background:var(--color-lightGray)!important}table[_ngcontent-%COMP%]{width:100%;font-family:DM Sans;background:#f7f7fa;border-radius:10px}th.mat-header-cell[_ngcontent-%COMP%]{border:none;font-size:14px!important;font-weight:700;color:var(--color-gray);height:21px}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]{border:none;min-width:60px;white-space:nowrap;padding-right:24px}th.mat-header-cell[_ngcontent-%COMP%]   span.alert-danger[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]   span.alert-danger[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]   span.alert-danger[_ngcontent-%COMP%]{color:var(--color-red);font-weight:700;background:transparent;border:none}th.mat-header-cell[_ngcontent-%COMP%]   span.alert-success[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]   span.alert-success[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]   span.alert-success[_ngcontent-%COMP%]{color:var(--color-green);font-weight:700;background:transparent;border:none}td.mat-cell[_ngcontent-%COMP%]{font-size:16px}tr.mat-row[_ngcontent-%COMP%], tr.mat-footer-row[_ngcontent-%COMP%]{height:88px;border-radius:8px;cursor:pointer}tr.mat-row.upcoming[_ngcontent-%COMP%]{background:#e6fff3!important}td[_ngcontent-%COMP%]:first-child, th[_ngcontent-%COMP%]:first-child{border-radius:8px 0 0 8px}td[_ngcontent-%COMP%]:last-child, th[_ngcontent-%COMP%]:last-child{border-radius:0 8px 8px 0}.actions-btn-wrap[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{outline:none;border:none;height:36px;min-width:102px;padding:6px 8px;background:white;border-radius:4px;color:var(--color-black);font-family:DM Sans;font-size:16px}.actions-btn-wrap[_ngcontent-%COMP%]   .blue-btn[_ngcontent-%COMP%]{background:var(--color-lightGray);color:var(--color-darkBlue)}.actions-btn-wrap[_ngcontent-%COMP%]   .pink-btn[_ngcontent-%COMP%]{background:var(--color-lightPink);color:var(--color-red)}.intel-accordion-con[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{display:flex}.input-group[_ngcontent-%COMP%]{background:var(--color-white);border:1px solid rgba(127,123,146,.5);border-radius:6px;height:46px;align-items:center;max-width:60vw;width:300px;display:none}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background:none;border:none;cursor:default}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;font-size:16px;line-height:150%;padding-left:16px}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:none}@media (max-width: 768px){.input-group[_ngcontent-%COMP%]{width:100%;max-width:100%;margin:10px 0}.intel-accordion-con[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%], .intel-accordion-con[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:fit-content}}"]}),n})();var V=a(6895),R=a(9832);const D=[{path:"",component:I}];function A(n){return new R.w(n,"./assets/i18n/",".json")}let E=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.Bz.forChild(D),V.ez,g.To,r.p0,f.AV,C.Ps,m.ot,p.Bz]}),n})()}}]);