"use strict";(self.webpackChunkintelehealth_ui=self.webpackChunkintelehealth_ui||[]).push([[478],{6478:(N,d,o)=>{o.r(d),o.d(d,{HttpLoaderFactory:()=>I,VideoCallO3Module:()=>A});var h=o(7761),i=o(1149),g=o(9824),u=o(1279),m=o(1377),p=o(4476),C=o(9671),f=(o(685),o(2678),o(4465)),t=o(4650),x=o(7185),O=o(5383),M=o(9080),v=o(7154),P=o(3787);function b(n,a){1&n&&(t.TgZ(0,"th",11),t._uU(1,"Name"),t.qZA())}function T(n,a){if(1&n&&(t.TgZ(0,"td",12),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.name)}}function w(n,a){1&n&&(t.TgZ(0,"th",11),t._uU(1,"UUID"),t.qZA())}function k(n,a){if(1&n&&(t.TgZ(0,"td",13),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.uuid)}}function U(n,a){1&n&&(t.TgZ(0,"th",11),t._uU(1,"Action"),t.qZA())}function y(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",13)(1,"button",14),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.handleCallUser(c.uuid,c.name))}),t._uU(2,"Call"),t.qZA()()}}function _(n,a){1&n&&t._UZ(0,"tr",15)}function S(n,a){1&n&&t._UZ(0,"tr",16)}let V=(()=>{class n{constructor(e,l,r,c,s){this.toastr=e,this.socketService=l,this.coreService=r,this.pageTitleService=c,this.openmrs3service=s,this.socket=null,this.displayedColumns=["name","uuid","action"],this.roomId=null,this.isCalling=!1,this.callTo=null,this.callAccepted=!1,this.token="",this.calledBy=null,this.isMuted=!1,this.isVideoOn=!1,this.room=null,this.callerName=null,this.dataSource=new i.by,this.currentUser=(0,f.TL)(!0,"user"),this.members=[{name:"Super User",uuid:"82f18b44-6814-11e8-923f-e9a88dcb533f"},{name:"Admin2",uuid:"0a09425b-9cea-4f04-a90d-200cda5edb1f"}],this.WS_URL="wss://demo.intelehealth.org:9090",this.SOCKET_SERVER_URL="wss://intelehealth-o3.mpower-social.com:3004",this.SERVER_URL_RTC="https://intelehealth-o3.mpower-social.com:3000"}handleAction(e){console.log("Action clicked for UUID:",e)}ngOnInit(){var e=this;return(0,C.Z)(function*(){e.dataSource.data=e.members,console.table(e.dataSource.data),console.log("ngOnInitngOnInit"),e.socket||(yield e.socketService.initSocket(!0)),console.log(e.socketService.socket,"this.socketService.socket"),e.socket=e.socketService.socket,e.pageTitleService.setTitle({title:"Video call to OpenMRS 3",imgUrl:"assets/svgs/video-frame.svg"})})()}ngOnDestroy(){}getToken(e,l){fetch(`${this.SERVER_URL_RTC}/api/getToken?name=b338f57d-69a9-4884-b077-c2059baf9ba4&roomId=${e}&nurseName=${l}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(c=>c.json()).then(c=>{this.token=c.token}).catch(c=>{console.error("Error fetching the token:",c)})}startCall(){if(this.dialogRef2)return this.dialogRef2.close(),void(this.isCalling=!1);this.isCalling=!0,this.dialogRef2=this.coreService.openVideoCallModal({patientId:this.generateUUID(),visitId:"",connectToDrId:this.currentUser.uuid,patientName:"Super User",nurseId:"82f18b44-6814-11e8-923f-e9a88dcb533f",initiator:"dr",drPersonUuid:"82f18b44-6814-11e8-923f-e9a88dcb533f"}),this.dialogRef2.afterClosed().subscribe(e=>{this.dialogRef2=void 0,this.isCalling=!1})}handleCallUser(e,l){if(console.log("handleCallUser",e,this.socket),this.socket){const r=this.generateUUID();this.openmrs3service.getCall={nurseId:e,roomId:r},this.getToken(r,e),this.roomId=r,this.callTo={name:l,nurseId:e},this.isCalling=!0,this.socket.emit("create_or_join_hw",{patientId:r,connectToDrId:e}),this.socket.emit("call",{nurseId:e,doctorName:this.currentUser.name,roomId:r})}this.startCall()}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const l=16*Math.random()|0;return("x"===e?l:3&l|8).toString(16)})}resetCall(){this.room?.disconnect(),this.roomId=null,this.isCalling=!1,this.callAccepted=!1,this.callTo=null,this.calledBy=null,this.room=null,this.isMuted=!1,this.isVideoOn=!1}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x._W),t.Y36(O.$),t.Y36(M.p),t.Y36(v.Z),t.Y36(P.N))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-video-call-list-data-table"]],decls:14,vars:3,consts:[[1,"container-fluid"],[1,"mat-elevation-z8"],["mat-table","",1,"mat-elevation-z8",2,"width","100%",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","font-weight: bold;",4,"matCellDef"],["matColumnDef","uuid"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",2,"font-weight","bold"],["mat-cell",""],["mat-raised-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,l){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"table",2),t.ynx(3,3),t.YNc(4,b,2,0,"th",4),t.YNc(5,T,2,1,"td",5),t.BQk(),t.ynx(6,6),t.YNc(7,w,2,0,"th",4),t.YNc(8,k,2,1,"td",7),t.BQk(),t.ynx(9,8),t.YNc(10,U,2,0,"th",4),t.YNc(11,y,3,0,"td",7),t.BQk(),t.YNc(12,_,1,0,"tr",9),t.YNc(13,S,1,0,"tr",10),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("dataSource",l.dataSource),t.xp6(10),t.Q6J("matHeaderRowDef",l.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",l.displayedColumns))},dependencies:[i.BZ,i.fO,i.as,i.w1,i.Dz,i.nj,i.ge,i.ev,i.XQ,i.Gk,m.lW],styles:[".mat-elevation-z8[_ngcontent-%COMP%]{box-shadow:none;width:100%;overflow-x:auto}.container-fluid[_ngcontent-%COMP%]{box-shadow:0 4px 24px #1f1c3a14;padding:10px;border-radius:10px}.action-btn.bg-blue[_ngcontent-%COMP%]{background:var(--color-lightGray)!important}table[_ngcontent-%COMP%]{width:100%;font-family:DM Sans;background:#f7f7fa;border-radius:10px}th.mat-header-cell[_ngcontent-%COMP%]{border:none;font-size:14px!important;font-weight:700;color:var(--color-gray);height:21px}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]{border:none;min-width:60px;white-space:nowrap;padding-right:24px}th.mat-header-cell[_ngcontent-%COMP%]   span.alert-danger[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]   span.alert-danger[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]   span.alert-danger[_ngcontent-%COMP%]{color:var(--color-red);font-weight:700;background:transparent;border:none}th.mat-header-cell[_ngcontent-%COMP%]   span.alert-success[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]   span.alert-success[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]   span.alert-success[_ngcontent-%COMP%]{color:var(--color-green);font-weight:700;background:transparent;border:none}td.mat-cell[_ngcontent-%COMP%]{font-size:16px}tr.mat-row[_ngcontent-%COMP%], tr.mat-footer-row[_ngcontent-%COMP%]{height:88px;border-radius:8px;cursor:pointer}tr.mat-row.upcoming[_ngcontent-%COMP%]{background:#e6fff3!important}td[_ngcontent-%COMP%]:first-child, th[_ngcontent-%COMP%]:first-child{border-radius:8px 0 0 8px}td[_ngcontent-%COMP%]:last-child, th[_ngcontent-%COMP%]:last-child{border-radius:0 8px 8px 0}.actions-btn-wrap[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{outline:none;border:none;height:36px;min-width:102px;padding:6px 8px;background:white;border-radius:4px;color:var(--color-black);font-family:DM Sans;font-size:16px}.actions-btn-wrap[_ngcontent-%COMP%]   .blue-btn[_ngcontent-%COMP%]{background:var(--color-lightGray);color:var(--color-darkBlue)}.actions-btn-wrap[_ngcontent-%COMP%]   .pink-btn[_ngcontent-%COMP%]{background:var(--color-lightPink);color:var(--color-red)}.intel-accordion-con[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{display:flex}.input-group[_ngcontent-%COMP%]{background:var(--color-white);border:1px solid rgba(127,123,146,.5);border-radius:6px;height:46px;align-items:center;max-width:60vw;width:300px;display:none}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background:none;border:none;cursor:default}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;font-size:16px;line-height:150%;padding-left:16px}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:none}@media (max-width: 768px){.input-group[_ngcontent-%COMP%]{width:100%;max-width:100%;margin:10px 0}.intel-accordion-con[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%], .intel-accordion-con[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:fit-content}}"]}),n})();var R=o(6895),D=o(9832);const Z=[{path:"",component:V}];function I(n){return new D.w(n,"./assets/i18n/",".json")}let A=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(Z),R.ez,h.To,i.p0,g.AV,u.Ps,m.ot,p.Bz]}),n})()}}]);